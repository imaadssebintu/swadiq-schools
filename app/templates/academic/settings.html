<!-- Loading Spinner -->
<div id="loadingSpinner" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"></div>
        <span class="text-gray-700">Loading...</span>
    </div>
</div>

<!-- Academic Settings Page -->
<div class="p-4 lg:p-6">
    <div class="mb-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900 mb-1">
                    Academic Settings ðŸ“š
                </h1>
                <p class="text-gray-600 text-sm">Manage academic years and terms</p>
            </div>
            <div class="hidden lg:flex items-center space-x-3">
                <button id="addAcademicYearBtn" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center">
                    <i class="fas fa-plus mr-2"></i>Add Academic Year
                </button>
            </div>
        </div>
    </div>

    <!-- Academic Years Section -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-bold text-gray-900">Academic Years</h2>
            <div class="relative">
                <input type="text" id="searchAcademicYears" placeholder="Search academic years..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Date</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Terms</th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="academicYearsTableBody">
                    <!-- Academic years will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Terms Section -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-bold text-gray-900">Terms</h2>
            <div class="flex space-x-2">
                <div class="relative">
                    <select id="academicYearFilter" class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                        <option value="">All Academic Years</option>
                        <!-- Academic years will be loaded here -->
                    </select>
                    <i class="fas fa-filter absolute left-3 top-3 text-gray-400"></i>
                </div>
                <button id="addTermBtn" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center">
                    <i class="fas fa-plus mr-2"></i>Add Term
                </button>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Academic Year</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Date</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="termsTableBody">
                    <!-- Terms will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Academic Year Modal -->
<div id="academicYearModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-4">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900" id="academicYearModalTitle">Add Academic Year</h3>
        </div>
        <form id="academicYearForm" class="px-6 py-4">
            <input type="hidden" id="academicYearId">
            <div class="mb-4">
                <label for="academicYearName" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                <input type="text" id="academicYearName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
            </div>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="academicYearStartDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                    <input type="date" id="academicYearStartDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                </div>
                <div>
                    <label for="academicYearEndDate" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                    <input type="date" id="academicYearEndDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                </div>
            </div>
            <div class="flex items-center mb-4">
                <input type="checkbox" id="academicYearIsActive" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                <label for="academicYearIsActive" class="ml-2 block text-sm text-gray-700">Active</label>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" id="cancelAcademicYearBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    Save
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Term Modal -->
<div id="termModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-4">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900" id="termModalTitle">Add Term</h3>
        </div>
        <form id="termForm" class="px-6 py-4">
            <input type="hidden" id="termId">
            <div class="mb-4">
                <label for="termName" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                <input type="text" id="termName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
            </div>
            <div class="mb-4">
                <label for="termAcademicYear" class="block text-sm font-medium text-gray-700 mb-1">Academic Year</label>
                <select id="termAcademicYear" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                    <option value="">Select Academic Year</option>
                    <!-- Academic years will be loaded here -->
                </select>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="termStartDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                    <input type="date" id="termStartDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                </div>
                <div>
                    <label for="termEndDate" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                    <input type="date" id="termEndDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                </div>
            </div>
            <div class="flex items-center mb-4">
                <input type="checkbox" id="termIsActive" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                <label for="termIsActive" class="ml-2 block text-sm text-gray-700">Active</label>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" id="cancelTermBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    Save
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-4">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">Confirm Delete</h3>
        </div>
        <div class="px-6 py-4">
            <p class="text-gray-600">Are you sure you want to delete this item? This action cannot be undone.</p>
            <input type="hidden" id="deleteItemId">
            <input type="hidden" id="deleteItemType"> <!-- academic_year or term -->
        </div>
        <div class="px-6 py-4 bg-gray-50 rounded-b-xl flex justify-end space-x-3">
            <button type="button" id="cancelDeleteBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                Cancel
            </button>
            <button type="button" id="confirmDeleteBtn" class="px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                Delete
            </button>
        </div>
    </div>
</div>

<script>
    // Global variables
    let academicYears = [];
    let terms = [];
    const loadingSpinner = document.getElementById('loadingSpinner');

    // Loading functions
    function showLoading() {
        loadingSpinner.classList.remove('hidden');
    }

    function hideLoading() {
        loadingSpinner.classList.add('hidden');
    }

    // DOM Elements
    const academicYearsTableBody = document.getElementById('academicYearsTableBody');
    const termsTableBody = document.getElementById('termsTableBody');
    const academicYearFilter = document.getElementById('academicYearFilter');
    const termAcademicYear = document.getElementById('termAcademicYear');

    // Modal Elements
    const academicYearModal = document.getElementById('academicYearModal');
    const termModal = document.getElementById('termModal');
    const deleteModal = document.getElementById('deleteModal');

    // Form Elements
    const academicYearForm = document.getElementById('academicYearForm');
    const termForm = document.getElementById('termForm');

    // Button Elements
    const addAcademicYearBtn = document.getElementById('addAcademicYearBtn');
    const addTermBtn = document.getElementById('addTermBtn');
    const cancelAcademicYearBtn = document.getElementById('cancelAcademicYearBtn');
    const cancelTermBtn = document.getElementById('cancelTermBtn');
    const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
        loadAcademicYears();
        loadTerms();

        // Event Listeners
        addAcademicYearBtn.addEventListener('click', showAddAcademicYearModal);
        addTermBtn.addEventListener('click', showAddTermModal);
        cancelAcademicYearBtn.addEventListener('click', hideAcademicYearModal);
        cancelTermBtn.addEventListener('click', hideTermModal);
        cancelDeleteBtn.addEventListener('click', hideDeleteModal);
        confirmDeleteBtn.addEventListener('click', confirmDelete);
        academicYearForm.addEventListener('submit', saveAcademicYear);
        termForm.addEventListener('submit', saveTerm);

        // Filter event
        academicYearFilter.addEventListener('change', filterTerms);
    });

    // Load academic years
    async function loadAcademicYears() {
        showLoading();
        try {
            const response = await fetch('/api/academic-years');
            academicYears = await response.json();
            renderAcademicYears();
            populateAcademicYearDropdowns();
        } catch (error) {
            console.error('Error loading academic years:', error);
            showError('Failed to load academic years');
        } finally {
            hideLoading();
        }
    }

    // Load terms
    async function loadTerms() {
        showLoading();
        try {
            const response = await fetch('/api/terms');
            terms = await response.json();
            console.log('Loaded terms:', terms); // Debug log
            renderTerms();
        } catch (error) {
            console.error('Error loading terms:', error);
            showError('Failed to load terms');
        } finally {
            hideLoading();
        }
    }

    // Render academic years table
    function renderAcademicYears() {
        academicYearsTableBody.innerHTML = '';
        
        if (academicYears.length === 0) {
            academicYearsTableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                        No academic years found
                    </td>
                </tr>
            `;
            return;
        }

        academicYears.forEach(year => {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50';
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${year.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(year.start_date)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(year.end_date)}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                        ${year.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                        ${year.is_active ? 'Active' : 'Inactive'}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    ${year.terms ? year.terms.length : 0} terms
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button onclick="editAcademicYear('${year.id}')" class="text-primary-600 hover:text-primary-900 mr-3">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="showDeleteModal('${year.id}', 'academic_year')" class="text-red-600 hover:text-red-900">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            academicYearsTableBody.appendChild(row);
        });
    }

    // Render terms table
    function renderTerms() {
        termsTableBody.innerHTML = '';
        
        if (terms.length === 0) {
            termsTableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                        No terms found
                    </td>
                </tr>
            `;
            return;
        }

        // Apply filter if selected
        const filteredTerms = filterTermsByAcademicYear(terms);

        filteredTerms.forEach(term => {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50';
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${term.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${term.academic_year ? term.academic_year.name : 'N/A'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(term.start_date)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(term.end_date)}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                        ${term.is_current ? 'bg-blue-100 text-blue-800' : (term.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800')}">
                        ${term.is_current ? 'Current' : (term.is_active ? 'Active' : 'Inactive')}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button onclick="editTerm('${term.id}')" class="text-primary-600 hover:text-primary-900 mr-3">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="showDeleteModal('${term.id}', 'term')" class="text-red-600 hover:text-red-900">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            termsTableBody.appendChild(row);
        });
    }

    // Populate academic year dropdowns
    function populateAcademicYearDropdowns() {
        // Clear existing options
        academicYearFilter.innerHTML = '<option value="">All Academic Years</option>';
        termAcademicYear.innerHTML = '<option value="">Select Academic Year</option>';

        // Add academic years
        academicYears.forEach(year => {
            const option = document.createElement('option');
            option.value = year.id;
            option.textContent = year.name;
            academicYearFilter.appendChild(option.cloneNode(true));
            termAcademicYear.appendChild(option);
        });
    }

    // Filter terms by academic year
    function filterTermsByAcademicYear(termsList) {
        const selectedAcademicYear = academicYearFilter.value;
        if (!selectedAcademicYear) {
            return termsList;
        }
        return termsList.filter(term => term.academic_year_id === selectedAcademicYear);
    }

    // Filter terms when academic year filter changes
    function filterTerms() {
        renderTerms();
    }

    // Show add academic year modal
    function showAddAcademicYearModal() {
        document.getElementById('academicYearModalTitle').textContent = 'Add Academic Year';
        document.getElementById('academicYearId').value = '';
        document.getElementById('academicYearName').value = '';
        document.getElementById('academicYearStartDate').value = '';
        document.getElementById('academicYearEndDate').value = '';
        document.getElementById('academicYearIsActive').checked = true;
        academicYearModal.classList.remove('hidden');
    }

    // Show edit academic year modal
    function editAcademicYear(id) {
        const academicYear = academicYears.find(y => y.id === id);
        if (!academicYear) return;

        document.getElementById('academicYearModalTitle').textContent = 'Edit Academic Year';
        document.getElementById('academicYearId').value = academicYear.id;
        document.getElementById('academicYearName').value = academicYear.name;
        document.getElementById('academicYearStartDate').value = formatDateForInput(academicYear.start_date);
        document.getElementById('academicYearEndDate').value = formatDateForInput(academicYear.end_date);
        document.getElementById('academicYearIsActive').checked = academicYear.is_active;
        academicYearModal.classList.remove('hidden');
    }

    // Hide academic year modal
    function hideAcademicYearModal() {
        academicYearModal.classList.add('hidden');
    }

    // Show add term modal
    function showAddTermModal() {
        document.getElementById('termModalTitle').textContent = 'Add Term';
        document.getElementById('termId').value = '';
        document.getElementById('termName').value = '';
        document.getElementById('termAcademicYear').value = '';
        document.getElementById('termStartDate').value = '';
        document.getElementById('termEndDate').value = '';
        document.getElementById('termIsActive').checked = true;
        termModal.classList.remove('hidden');
    }

    // Show edit term modal
    function editTerm(id) {
        const term = terms.find(t => t.id === id);
        if (!term) return;

        document.getElementById('termModalTitle').textContent = 'Edit Term';
        document.getElementById('termId').value = term.id;
        document.getElementById('termName').value = term.name;
        document.getElementById('termAcademicYear').value = term.academic_year_id;
        document.getElementById('termStartDate').value = formatDateForInput(term.start_date);
        document.getElementById('termEndDate').value = formatDateForInput(term.end_date);
        document.getElementById('termIsActive').checked = term.is_active;
        termModal.classList.remove('hidden');
    }

    // Hide term modal
    function hideTermModal() {
        termModal.classList.add('hidden');
    }

    // Save academic year
    async function saveAcademicYear(e) {
        e.preventDefault();
        
        const id = document.getElementById('academicYearId').value;
        const name = document.getElementById('academicYearName').value;
        const startDate = document.getElementById('academicYearStartDate').value;
        const endDate = document.getElementById('academicYearEndDate').value;
        const isActive = document.getElementById('academicYearIsActive').checked;

        // Validate that dates are provided
        if (!startDate || !endDate) {
            showError('Please provide both start and end dates');
            return;
        }

        const academicYearData = {
            name: name,
            start_date: startDate,
            end_date: endDate,
            is_active: isActive,
            is_current: false  // Add this field to match the model
        };

        showLoading();
        try {
            let response;
            if (id) {
                // Update existing academic year
                response = await fetch(`/api/academic-years/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(academicYearData)
                });
            } else {
                // Create new academic year
                response = await fetch('/api/academic-years', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(academicYearData)
                });
            }

            if (response.ok) {
                hideAcademicYearModal();
                loadAcademicYears();
                showSuccess('Academic year saved successfully');
            } else {
                const error = await response.json();
                showError(error.error || 'Failed to save academic year');
            }
        } catch (error) {
            console.error('Error saving academic year:', error);
            showError('Failed to save academic year');
        } finally {
            hideLoading();
        }
    }

    // Save term
    async function saveTerm(e) {
        e.preventDefault();
        
        const id = document.getElementById('termId').value;
        const name = document.getElementById('termName').value;
        const academicYearId = document.getElementById('termAcademicYear').value;
        const startDate = document.getElementById('termStartDate').value;
        const endDate = document.getElementById('termEndDate').value;
        const isActive = document.getElementById('termIsActive').checked;

        const termData = {
            name: name,
            academic_year_id: academicYearId,
            start_date: startDate,
            end_date: endDate,
            is_active: isActive
        };

        showLoading();
        try {
            let response;
            if (id) {
                // Update existing term
                response = await fetch(`/api/terms/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(termData)
                });
            } else {
                // Create new term
                response = await fetch('/api/terms', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(termData)
                });
            }

            if (response.ok) {
                hideTermModal();
                loadTerms();
                showSuccess('Term saved successfully');
            } else {
                const error = await response.json();
                showError(error.error || 'Failed to save term');
            }
        } catch (error) {
            console.error('Error saving term:', error);
            showError('Failed to save term');
        } finally {
            hideLoading();
        }
    }

    // Show delete confirmation modal
    function showDeleteModal(id, type) {
        document.getElementById('deleteItemId').value = id;
        document.getElementById('deleteItemType').value = type;
        deleteModal.classList.remove('hidden');
    }

    // Hide delete confirmation modal
    function hideDeleteModal() {
        deleteModal.classList.add('hidden');
    }

    // Confirm delete
    async function confirmDelete() {
        const id = document.getElementById('deleteItemId').value;
        const type = document.getElementById('deleteItemType').value;

        showLoading();
        try {
            let response;
            if (type === 'academic_year') {
                response = await fetch(`/api/academic-years/${id}`, {
                    method: 'DELETE'
                });
            } else if (type === 'term') {
                response = await fetch(`/api/terms/${id}`, {
                    method: 'DELETE'
                });
            }

            if (response.ok) {
                hideDeleteModal();
                if (type === 'academic_year') {
                    loadAcademicYears();
                } else {
                    loadTerms();
                }
                showSuccess('Item deleted successfully');
            } else {
                const error = await response.json();
                showError(error.error || 'Failed to delete item');
            }
        } catch (error) {
            console.error('Error deleting item:', error);
            showError('Failed to delete item');
        } finally {
            hideLoading();
        }
    }

    // Helper functions
    function formatDate(dateString) {
        if (!dateString) return 'N/A';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    }

    function formatDateForInput(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toISOString().split('T')[0];
    }

    function showSuccess(message) {
        // In a real implementation, you would show a toast or notification
        alert('Success: ' + message);
    }

    function showError(message) {
        // In a real implementation, you would show a toast or notification
        alert('Error: ' + message);
    }

    // Make functions available globally for inline event handlers
    window.editAcademicYear = editAcademicYear;
    window.editTerm = editTerm;
    window.showDeleteModal = showDeleteModal;
</script>