<!-- Results Entry Page -->
<div class="min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 py-4 lg:px-6 lg:py-5">
        <!-- Page Header -->
        <div class="mb-6">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div class="flex items-center gap-4">
                    <button id="backToExamsBtn"
                        class="w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-slate-200 text-slate-400 hover:text-indigo-600 hover:bg-slate-50 transition-all shadow-sm">
                        <i class="fas fa-arrow-left text-sm"></i>
                    </button>
                    <div>
                        <h1 class="text-lg font-black text-slate-900 tracking-tight uppercase">Enter Results</h1>
                        <div class="flex flex-wrap items-center gap-x-3 gap-y-1 mt-1">
                            <span id="examDescription"
                                class="text-slate-400 text-[10px] font-bold uppercase tracking-wider">Loading
                                details...</span>
                            <div class="hidden xs:block w-1 h-1 rounded-full bg-slate-300"></div>
                            <span
                                class="text-emerald-600 text-[10px] font-black uppercase tracking-widest bg-emerald-50 px-2 py-0.5 rounded-lg border border-emerald-100">ASSESSMENT
                                MODE</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="saveAllResultsBtn"
                        class="flex-1 sm:flex-none justify-center px-6 py-2.5 premium-gradient text-white rounded-xl hover:opacity-90 transition-all duration-200 text-[11px] font-black uppercase tracking-widest shadow-lg shadow-indigo-100 ring-2 ring-white flex items-center gap-2">
                        <i class="fas fa-save"></i>
                        <span>Save All (Batch)</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Exam Details Stats Cards -->
        <div id="examDetailsCard" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 hidden">
            <!-- Assessment Name -->
            <div
                class="group bg-gradient-to-br from-indigo-500 to-blue-600 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 p-3 transform hover:-translate-y-1 cursor-pointer">
                <div class="flex items-center justify-between">
                    <div class="flex-1 min-w-0">
                        <p class="text-[10px] font-semibold text-indigo-100 uppercase tracking-widest mb-1">Assessment
                        </p>
                        <h3 id="examName" class="text-sm font-extrabold text-white truncate">-</h3>
                        <div
                            class="h-1 w-12 bg-white/30 rounded-full group-hover:w-20 transition-all duration-300 mt-1.5">
                        </div>
                    </div>
                    <div
                        class="bg-white/20 backdrop-blur-sm p-2 rounded-lg group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-file-alt text-white text-lg"></i>
                    </div>
                </div>
            </div>

            <!-- Class -->
            <div
                class="group bg-gradient-to-br from-cyan-500 to-blue-500 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 p-3 transform hover:-translate-y-1 cursor-pointer">
                <div class="flex items-center justify-between">
                    <div class="flex-1 min-w-0">
                        <p class="text-[10px] font-semibold text-cyan-100 uppercase tracking-widest mb-1">Target Class
                        </p>
                        <h3 id="examClass" class="text-sm font-extrabold text-white truncate">-</h3>
                        <div
                            class="h-1 w-12 bg-white/30 rounded-full group-hover:w-20 transition-all duration-300 mt-1.5">
                        </div>
                    </div>
                    <div
                        class="bg-white/20 backdrop-blur-sm p-2 rounded-lg group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-users text-white text-lg"></i>
                    </div>
                </div>
            </div>

            <!-- Paper -->
            <div
                class="group bg-gradient-to-br from-pink-500 to-rose-500 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 p-3 transform hover:-translate-y-1 cursor-pointer">
                <div class="flex items-center justify-between">
                    <div class="flex-1 min-w-0">
                        <p class="text-[10px] font-semibold text-pink-100 uppercase tracking-widest mb-1">Paper Module
                        </p>
                        <h3 id="examPaper" class="text-sm font-extrabold text-white truncate">-</h3>
                        <div
                            class="h-1 w-12 bg-white/30 rounded-full group-hover:w-20 transition-all duration-300 mt-1.5">
                        </div>
                    </div>
                    <div
                        class="bg-white/20 backdrop-blur-sm p-2 rounded-lg group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-book text-white text-lg"></i>
                    </div>
                </div>
            </div>

            <!-- Date & Time -->
            <div
                class="group bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 p-3 transform hover:-translate-y-1 cursor-pointer">
                <div class="flex items-center justify-between">
                    <div class="flex-1 min-w-0">
                        <p class="text-[10px] font-semibold text-purple-100 uppercase tracking-widest mb-1">Schedule</p>
                        <h3 id="examDateTime" class="text-[11px] font-extrabold text-white truncate">-</h3>
                        <div
                            class="h-1 w-12 bg-white/30 rounded-full group-hover:w-20 transition-all duration-300 mt-1.5">
                        </div>
                    </div>
                    <div
                        class="bg-white/20 backdrop-blur-sm p-2 rounded-lg group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-calendar-alt text-white text-lg"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Student Results Roster -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="px-5 py-4 border-b border-slate-100 bg-slate-50/30">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div>
                        <h2 class="text-[11px] font-black text-slate-900 uppercase tracking-widest">Student Results</h2>
                        <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest mt-0.5">Marks Entry
                            Registry</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <div id="searchResultCount"
                            class="text-[10px] font-bold text-slate-500 hidden uppercase tracking-wider">
                            <span id="visibleCount">0</span> of <span id="totalCount">0</span> SELECTION
                        </div>
                        <div class="relative group">
                            <i
                                class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-[10px] group-focus-within:text-indigo-500 transition-colors"></i>
                            <input type="text" id="searchStudent" placeholder="SEARCH STUDENT..."
                                class="pl-9 pr-4 py-2 bg-white border border-slate-200 rounded-xl text-[11px] font-bold uppercase tracking-tight focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all w-full sm:w-64 placeholder:text-slate-300">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Desktop Table View -->
            <div class="hidden md:block overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead class="bg-slate-50/50 border-b border-slate-100">
                        <tr>
                            <th class="px-5 py-3 text-left w-[60px]">
                                <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest">#</span>
                            </th>
                            <th class="px-5 py-3 text-left">
                                <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Student
                                    Profile</span>
                            </th>
                            <th class="px-5 py-3 text-left w-[150px]">
                                <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest">ID
                                    Ref</span>
                            </th>
                            <th class="px-5 py-3 text-left min-w-[200px]">
                                <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Performance
                                    (Marks)</span>
                            </th>
                            <th class="px-5 py-3 text-right w-[120px]">
                                <span
                                    class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Status</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody" class="bg-white divide-y divide-slate-100">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>

            <!-- Mobile Card View -->
            <div id="resultsCardView" class="md:hidden divide-y divide-slate-100">
                <!-- Populated by JS -->
            </div>

            <!-- Loading Skeleton (Responsive) -->
            <div id="resultsLoadingSkeleton" class="p-6 space-y-4">
                <div class="animate-pulse flex items-center gap-4">
                    <div class="w-10 h-10 bg-slate-100 rounded-xl"></div>
                    <div class="flex-1 space-y-2">
                        <div class="h-3 bg-slate-100 rounded w-1/4"></div>
                        <div class="h-2 bg-slate-50 rounded w-1/2"></div>
                    </div>
                </div>
                <div class="animate-pulse flex items-center gap-4">
                    <div class="w-10 h-10 bg-slate-100 rounded-xl"></div>
                    <div class="flex-1 space-y-2">
                        <div class="h-3 bg-slate-100 rounded w-1/3"></div>
                        <div class="h-2 bg-slate-50 rounded w-1/2"></div>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div id="noStudentsMessage" class="hidden py-12 text-center">
                <div class="w-12 h-12 bg-slate-50 rounded-xl flex items-center justify-center mb-3 mx-auto">
                    <i class="fas fa-users-slash text-slate-300 text-xl"></i>
                </div>
                <p class="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-1">No Students Found</p>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">No records match your current
                    criteria</p>
            </div>
        </div>
    </div>
</div>

<!-- Success/Error Toast (Updated Style) -->
<div id="toast"
    class="fixed top-6 right-6 bg-white border border-slate-200 rounded-2xl shadow-2xl px-5 py-4 hidden z-50 transition-all transform scale-100 ring-1 ring-slate-900/5">
    <div class="flex items-center gap-3">
        <div id="toastIconBg" class="w-10 h-10 rounded-xl flex items-center justify-center">
            <i id="toastIcon" class="text-lg"></i>
        </div>
        <div>
            <div id="toastTitle" class="text-[11px] font-black text-slate-900 uppercase tracking-widest">Success</div>
            <div id="toastMessage" class="text-[10px] font-bold text-slate-500 uppercase tracking-tight">Results saved
                successfully</div>
        </div>
    </div>
</div>

<script>
    let examData = null;
    let studentsWithResults = [];
    const examID = '{{.examID}}';

    document.addEventListener('DOMContentLoaded', function () {
        loadExamWithStudents();

        document.getElementById('backToExamsBtn').addEventListener('click', () => {
            window.location.href = '/assessments';
        });

        document.getElementById('saveAllResultsBtn').addEventListener('click', saveAllResults);

        // Search functionality
        document.getElementById('searchStudent').addEventListener('input', filterStudents);
    });

    async function loadExamWithStudents() {
        try {
            const response = await fetch(`/api/assessments/${examID}/students-with-results`);
            if (!response.ok) {
                throw new Error('Failed to load exam data');
            }

            const data = await response.json();
            examData = data.exam;
            studentsWithResults = data.students || [];

            displayExamDetails();
            renderResultsTable();
        } catch (error) {
            console.error('Error loading exam data:', error);
            showToast('Error', 'Failed to load exam data', 'error');
        }
    }

    function displayExamDetails() {
        if (!examData) return;

        document.getElementById('examName').textContent = examData.name;
        document.getElementById('examClass').textContent = examData.class?.name || '-';
        document.getElementById('examPaper').textContent = examData.paper?.name || '-';

        const startDate = new Date(examData.start_time);
        const endTime = new Date(examData.end_time);
        const dateStr = startDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
        const timeStr = `${startDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} - ${endTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
        document.getElementById('examDateTime').textContent = `${dateStr} • ${timeStr}`;

        document.getElementById('examDescription').textContent = `${examData.class?.name || 'class'} • ${examData.paper?.name || 'assessment'}`;
        document.getElementById('examDetailsCard').classList.remove('hidden');
    }

    function renderResultsTable() {
        const tableBody = document.getElementById('resultsTableBody');
        const cardView = document.getElementById('resultsCardView');
        const emptyState = document.getElementById('noStudentsMessage');
        const skeleton = document.getElementById('resultsLoadingSkeleton');

        // Clear previous content
        tableBody.innerHTML = '';
        cardView.innerHTML = '';
        skeleton.classList.add('hidden');

        if (studentsWithResults.length === 0) {
            emptyState.classList.remove('hidden');
            return;
        } else {
            emptyState.classList.add('hidden');
        }

        studentsWithResults.forEach((swr, index) => {
            const student = swr.student;
            const result = swr.result;
            const hasResult = result && result.marks !== null && result.marks !== undefined;
            const statusClass = hasResult
                ? 'bg-emerald-50 text-emerald-600 border-emerald-100'
                : 'bg-amber-50 text-amber-600 border-amber-100';
            const statusText = hasResult ? 'SAVED' : 'PENDING';
            const initials = `${student.first_name?.charAt(0) || ''}${student.last_name?.charAt(0) || ''}`;

            // 1. Desktop Row
            const row = document.createElement('tr');
            row.className = 'hover:bg-indigo-50/30 transition-colors group border-b border-slate-50 last:border-b-0';
            row.dataset.studentId = student.id;
            row.innerHTML = `
                <td class="px-5 py-3">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">${index + 1}</span>
                </td>
                <td class="px-5 py-3">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-indigo-50 rounded-lg flex items-center justify-center border border-indigo-100 mr-3 group-hover:scale-105 transition-transform shadow-sm">
                            <span class="text-[10px] font-black text-indigo-600 uppercase">${initials}</span>
                        </div>
                        <div>
                            <p class="student-name-text text-[11px] font-black text-slate-700 uppercase tracking-wide group-hover:text-indigo-700 transition-colors">${student.first_name} ${student.last_name}</p>
                        </div>
                    </div>
                </td>
                <td class="px-5 py-3">
                    <span class="student-id-text inline-flex items-center px-2.5 py-0.5 rounded-full text-[10px] font-bold text-slate-600 bg-slate-100 border border-slate-200 uppercase tracking-wider">
                        ${student.student_id}
                    </span>
                </td>
                <td class="px-5 py-3">
                    <div class="relative max-w-[200px]">
                        <input 
                            type="number" 
                            step="0.01" 
                            min="0" 
                            max="100"
                            placeholder="ENTER MARKS..."
                            value="${hasResult ? result.marks : ''}"
                            data-student-id="${student.id}"
                            class="marks-input-desktop w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-[11px] font-bold uppercase tracking-tight focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all placeholder:text-slate-300"
                        />
                        <div class="saving-indicator-desktop hidden absolute right-3 top-1/2 -translate-y-1/2">
                            <i class="fas fa-spinner fa-spin text-indigo-400 text-[10px]"></i>
                        </div>
                    </div>
                </td>
                <td class="px-5 py-3 text-right">
                    <span class="status-badge-desktop inline-flex items-center px-2.5 py-1 rounded text-[9px] font-black uppercase tracking-wider border ${statusClass}">
                        ${statusText}
                    </span>
                </td>
            `;
            tableBody.appendChild(row);

            // 2. Mobile Card
            const card = document.createElement('div');
            card.className = 'p-4 group hover:bg-indigo-50/10 transition-colors';
            card.dataset.studentId = student.id;
            card.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center border border-indigo-100 mr-3 shadow-sm">
                            <span class="text-xs font-black text-indigo-600 uppercase">${initials}</span>
                        </div>
                        <div>
                            <p class="student-name-text text-xs font-black text-slate-700 uppercase tracking-tight">${student.first_name} ${student.last_name}</p>
                            <p class="student-id-text text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-0.5">${student.student_id}</p>
                        </div>
                    </div>
                    <span class="status-badge-mobile inline-flex items-center px-2 py-0.5 rounded-lg text-[9px] font-black uppercase tracking-wider border ${statusClass}">
                        ${statusText}
                    </span>
                </div>
                <div class="relative">
                    <div class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                        <i class="fas fa-edit text-[10px]"></i>
                    </div>
                    <input 
                        type="number" 
                        step="0.01" 
                        min="0" 
                        max="100"
                        placeholder="ENTER PERFORMANCE MARKS..."
                        value="${hasResult ? result.marks : ''}"
                        data-student-id="${student.id}"
                        class="marks-input-mobile w-full pl-9 pr-10 py-3 bg-slate-50 border border-slate-200 rounded-xl text-xs font-bold uppercase focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all placeholder:text-slate-300"
                    />
                    <div class="saving-indicator-mobile hidden absolute right-3 top-1/2 -translate-y-1/2">
                        <i class="fas fa-spinner fa-spin text-indigo-400 text-xs"></i>
                    </div>
                </div>
            `;
            cardView.appendChild(card);

            // Event Listeners
            const deskInput = row.querySelector('.marks-input-desktop');
            const mobInput = card.querySelector('.marks-input-mobile');

            deskInput.addEventListener('input', (e) => {
                mobInput.value = e.target.value;
                debounceAutoSave(e.target);
            });
            mobInput.addEventListener('input', (e) => {
                deskInput.value = e.target.value;
                debounceAutoSave(e.target);
            });
        });
    }

    const debounceAutoSave = debounce((input) => autoSaveResult(input), 1200);

    function filterStudents() {
        const searchQuery = document.getElementById('searchStudent').value.toLowerCase().trim();
        const rows = document.querySelectorAll('#resultsTableBody > tr');
        const cards = document.querySelectorAll('#resultsCardView > div');
        const searchResultCount = document.getElementById('searchResultCount');
        const visibleCountEl = document.getElementById('visibleCount');
        const totalCountEl = document.getElementById('totalCount');

        let visibleCount = 0;
        const totalCount = rows.length;

        rows.forEach((row, i) => {
            const card = cards[i];
            const studentId = row.querySelector('.student-id-text').textContent.toLowerCase();
            const studentName = row.querySelector('.student-name-text').textContent.toLowerCase();

            const matches = studentId.includes(searchQuery) || studentName.includes(searchQuery);

            if (matches || searchQuery === '') {
                row.style.display = '';
                if (card) card.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
                if (card) card.style.display = 'none';
            }
        });

        // Update search result count
        if (searchQuery === '') {
            searchResultCount.classList.add('hidden');
        } else {
            searchResultCount.classList.remove('hidden');
            visibleCountEl.textContent = visibleCount;
            totalCountEl.textContent = totalCount;
        }
    }

    // Debounce function to delay auto-save
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    async function autoSaveResult(input) {
        const marks = parseFloat(input.value);
        const studentId = input.dataset.studentId;

        // Skip if empty
        if (input.value === '') return;

        // Validate marks
        if (isNaN(marks)) {
            showToast('Error', 'Marks must be a valid number', 'error');
            return;
        }

        if (marks < 0 || marks > 100) {
            showToast('Error', 'Marks must be between 0 and 100', 'error');
            input.value = '';
            input.focus();
            return;
        }

        // Get both inputs and indicators
        const deskInput = document.querySelector(`.marks-input-desktop[data-student-id="${studentId}"]`);
        const mobInput = document.querySelector(`.marks-input-mobile[data-student-id="${studentId}"]`);
        const deskIndicator = document.querySelector(`.saving-indicator-desktop[data-student-id="${studentId}"]`) || deskInput?.nextElementSibling;
        const mobIndicator = document.querySelector(`.saving-indicator-mobile[data-student-id="${studentId}"]`) || mobInput?.nextElementSibling;
        const deskBadge = document.querySelector(`tr[data-student-id="${studentId}"] .status-badge-desktop`);
        const mobBadge = document.querySelector(`div[data-student-id="${studentId}"] .status-badge-mobile`);

        // Show saving indicators
        if (deskIndicator) deskIndicator.classList.remove('hidden');
        if (mobIndicator) mobIndicator.classList.remove('hidden');

        try {
            const response = await fetch('/api/results/batch', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    exam_id: examID,
                    paper_id: examData.paper_id,
                    term_id: examData.term_id,
                    results: [{
                        student_id: studentId,
                        marks: marks,
                        grade_id: null
                    }]
                })
            });

            if (!response.ok) throw new Error('Failed to save result');

            // Success feedback
            if (deskIndicator) deskIndicator.classList.add('hidden');
            if (mobIndicator) mobIndicator.classList.add('hidden');

            const successBadgeClass = 'inline-flex items-center px-2.5 py-1 rounded text-[9px] font-black uppercase tracking-wider border bg-emerald-50 text-emerald-600 border-emerald-100';
            if (deskBadge) {
                deskBadge.className = successBadgeClass + ' status-badge-desktop';
                deskBadge.textContent = 'SAVED';
            }
            if (mobBadge) {
                mobBadge.className = successBadgeClass + ' status-badge-mobile';
                mobBadge.textContent = 'SAVED';
            }

            [deskInput, mobInput].forEach(inp => {
                if (inp) {
                    inp.classList.add('ring-2', 'ring-emerald-500/20', 'border-emerald-500');
                    setTimeout(() => inp.classList.remove('ring-2', 'ring-emerald-500/20', 'border-emerald-500'), 1500);
                }
            });

        } catch (error) {
            console.error('Error saving result:', error);
            if (deskIndicator) deskIndicator.classList.add('hidden');
            if (mobIndicator) mobIndicator.classList.add('hidden');
            showToast('Error', 'Failed to save result', 'error');
        }
    }

    async function saveAllResults() {
        const marksInputs = document.querySelectorAll('.marks-input-desktop');
        const results = [];
        const saveBtn = document.getElementById('saveAllResultsBtn');
        const originalContent = saveBtn.innerHTML;

        // Collect all results
        marksInputs.forEach(input => {
            const marks = parseFloat(input.value);
            if (!isNaN(marks) && marks >= 0) {
                results.push({
                    student_id: input.dataset.studentId,
                    marks: marks,
                    grade_id: null
                });
            }
        });

        if (results.length === 0) {
            showToast('Warning', 'No marks entered to save', 'warning');
            return;
        }

        // Loading state
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> SAVING...';

        try {
            const response = await fetch('/api/results/batch', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    exam_id: examID,
                    paper_id: examData.paper_id,
                    term_id: examData.term_id,
                    results: results
                })
            });

            if (!response.ok) throw new Error('Failed to save results');

            const data = await response.json();
            showToast('Success', `${data.count} RESULTS REGISTERED`, 'success');

            // Refresh status
            setTimeout(() => {
                loadExamWithStudents();
                saveBtn.disabled = false;
                saveBtn.innerHTML = originalContent;
            }, 1000);
        } catch (error) {
            console.error('Error saving results:', error);
            showToast('Error', 'Failed to save results', 'error');
            saveBtn.disabled = false;
            saveBtn.innerHTML = originalContent;
        }
    }

    function showToast(title, message, type = 'success') {
        const toast = document.getElementById('toast');
        const toastIcon = document.getElementById('toastIcon');
        const toastIconBg = document.getElementById('toastIconBg');
        const toastTitle = document.getElementById('toastTitle');
        const toastMessage = document.getElementById('toastMessage');

        toast.classList.remove('hidden', 'translate-x-full', 'opacity-0');

        if (type === 'success') {
            toastIconBg.className = 'w-10 h-10 rounded-xl flex items-center justify-center bg-emerald-50 text-emerald-600';
            toastIcon.className = 'fas fa-check-circle';
        } else if (type === 'error') {
            toastIconBg.className = 'w-10 h-10 rounded-xl flex items-center justify-center bg-red-50 text-red-600';
            toastIcon.className = 'fas fa-exclamation-circle';
        } else {
            toastIconBg.className = 'w-10 h-10 rounded-xl flex items-center justify-center bg-amber-50 text-amber-600';
            toastIcon.className = 'fas fa-info-circle';
        }

        toastTitle.textContent = title;
        toastMessage.textContent = message;

        // Auto-hide
        setTimeout(() => toast.classList.add('hidden'), 3500);
    }
</script>