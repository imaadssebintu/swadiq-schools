<!-- Assessments Hub Page -->
<div class="min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 py-4 lg:px-6 lg:py-5 space-y-6">
        <!-- Page Header -->
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
            <div class="flex flex-col gap-1">
                <h1 class="text-xl font-black text-slate-900 tracking-tight uppercase">Assessments Hub</h1>
                <p class="text-[11px] font-bold text-slate-400 uppercase tracking-wider">Select a class to manage
                    assessments</p>
            </div>
            <div class="relative w-full sm:w-64">
                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
                <input type="text" id="searchClass" placeholder="Search classes..."
                    class="w-full pl-9 pr-4 py-2 bg-white border border-slate-200 rounded-xl text-xs focus:outline-none focus:ring-2 focus:ring-slate-900 focus:border-transparent transition-all shadow-sm">
            </div>
        </div>

        <!-- Classes Section -->
        <div id="classesView" class="space-y-4">
            <div class="flex items-center gap-2">
                <span
                    class="text-[10px] font-black text-slate-900 bg-slate-100 px-2 py-1 rounded-md uppercase tracking-widest">Available
                    Classes</span>
                <div class="h-px bg-slate-100 flex-1"></div>
            </div>

            <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse min-w-[600px]">
                        <thead>
                            <tr class="bg-slate-50 border-b border-slate-100">
                                <th class="px-5 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest">
                                    Class Name</th>
                                <th class="px-5 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest">
                                    Code</th>
                                <th class="px-5 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest">
                                    Subjects</th>
                                <th class="px-5 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest">
                                    Students</th>
                                <th
                                    class="px-5 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest text-right">
                                    Actions</th>
                            </tr>
                        </thead>
                        <tbody id="classesTableBody">
                            <!-- Skeleton Rows -->
                            <tr class="animate-pulse border-b border-slate-50 last:border-0">
                                <td class="px-5 py-4">
                                    <div class="h-3 w-28 bg-slate-100 rounded"></div>
                                </td>
                                <td class="px-5 py-4">
                                    <div class="h-3 w-16 bg-slate-100 rounded"></div>
                                </td>
                                <td class="px-5 py-4">
                                    <div class="h-5 w-20 bg-slate-100 rounded-lg"></div>
                                </td>
                                <td class="px-5 py-4 text-right">
                                    <div class="h-8 w-24 bg-slate-100 rounded-lg ml-auto"></div>
                                </td>
                            </tr>
                            <tr class="animate-pulse border-b border-slate-50 last:border-0">
                                <td class="px-5 py-4">
                                    <div class="h-3 w-24 bg-slate-100 rounded"></div>
                                </td>
                                <td class="px-5 py-4">
                                    <div class="h-3 w-14 bg-slate-100 rounded"></div>
                                </td>
                                <td class="px-5 py-4">
                                    <div class="h-5 w-20 bg-slate-100 rounded-lg"></div>
                                </td>
                                <td class="px-5 py-4 text-right">
                                    <div class="h-8 w-24 bg-slate-100 rounded-lg ml-auto"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- No Classes Message -->
            <div id="noClassesMessage"
                class="hidden py-12 text-center bg-white rounded-2xl border border-slate-100 shadow-sm">
                <div class="w-12 h-12 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-search text-slate-300"></i>
                </div>
                <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">No classes found</p>
            </div>
        </div>
    </div>
</div>

<script>
    let classes = [];

    document.addEventListener('DOMContentLoaded', function () {
        loadClasses();
        document.getElementById('searchClass').addEventListener('input', renderClasses);
    });

    async function loadClasses() {
        try {
            const response = await fetch('/api/classes');
            const data = await response.json();
            classes = Array.isArray(data) ? data : (data.classes || data.data || []);
            renderClasses();
        } catch (error) {
            console.error('Error loading classes:', error);
            classes = [];
            renderClasses();
        }
    }

    function renderClasses() {
        const tbody = document.getElementById('classesTableBody');
        const emptyState = document.getElementById('noClassesMessage');
        const searchQuery = document.getElementById('searchClass').value.toLowerCase().trim();

        tbody.innerHTML = '';

        const filteredClasses = classes.filter(cls =>
            cls.name.toLowerCase().includes(searchQuery) ||
            (cls.code && cls.code.toLowerCase().includes(searchQuery))
        );

        if (filteredClasses.length === 0) {
            emptyState.classList.remove('hidden');
            return;
        }

        emptyState.classList.add('hidden');

        filteredClasses.forEach(cls => {
            const row = document.createElement('tr');
            row.className = 'border-b border-slate-50 last:border-0 hover:bg-slate-50/50 transition-all duration-200 group';
            // Click on row (non-button area) navigates to manage
            row.onclick = (e) => {
                if (!e.target.closest('button')) {
                    window.location.href = `/assessments/${cls.id}`;
                }
            };

            const subjectsHtml = cls.subjects && cls.subjects.length > 0
                ? `<div class="flex flex-wrap gap-1">
                    ${cls.subjects.slice(0, 3).map(s => `
                        <span class="px-1.5 py-0.5 bg-slate-100 text-slate-500 rounded text-[8px] font-black uppercase tracking-widest border border-slate-200">
                            ${s.code || s.name}
                        </span>
                    `).join('')}
                    ${cls.subjects.length > 3 ? `<span class="text-[8px] font-black text-slate-400 pl-1">+${cls.subjects.length - 3} MORE</span>` : ''}
                   </div>`
                : '<span class="text-[9px] font-bold text-slate-300 uppercase tracking-widest italic">No subjects</span>';

            row.innerHTML = `
                <td class="px-5 py-4">
                    <div class="text-[11px] font-black text-slate-700 uppercase tracking-tight group-hover:text-indigo-600 transition-colors">${cls.name}</div>
                </td>
                <td class="px-5 py-4">
                    <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">${cls.code || '-'}</div>
                </td>
                <td class="px-5 py-4">
                    ${subjectsHtml}
                </td>
                <td class="px-5 py-4">
                    <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest bg-slate-100 text-slate-500 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors">
                        <i class="fas fa-users text-[8px]"></i>
                        ${cls.student_count || 0} Students
                    </span>
                </td>
                <td class="px-5 py-4 text-right">
                    <div class="flex items-center justify-end gap-2">
                        <a href="/assessments/${cls.id}" class="px-3 py-1.5 bg-slate-100 text-slate-600 rounded-lg text-[10px] font-black uppercase tracking-widest hover:bg-slate-200 transition-all flex items-center gap-1.5">
                            Manage <i class="fas fa-cog text-[8px] opacity-50"></i>
                        </a>
                        <button onclick="window.location.href='/results/subject-performance?class_id=${cls.id}'" 
                            class="px-3 py-1.5 bg-slate-100 text-slate-600 rounded-lg text-[10px] font-black uppercase tracking-widest hover:bg-slate-200 transition-all flex items-center gap-1.5 group/btn">
                            <i class="fas fa-book text-[8px]"></i>
                            <span>Subject</span>
                        </button>
                        <button onclick="window.location.href='/results/class-performance?class_id=${cls.id}'" 
                            class="px-3 py-1.5 bg-slate-900 text-white rounded-lg text-[10px] font-black uppercase tracking-widest hover:bg-emerald-600 transition-all shadow-sm flex items-center gap-1.5 relative overflow-hidden group/btn">
                            <i class="fas fa-chart-line text-[8px]"></i>
                            <span>Matrix</span>
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
    }
</script>